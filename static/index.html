<!DOCTYPE html>
<html>
<head>
    <title>æ—…æ¸¸åŠ©æ‰‹æµ‹è¯•é¡µ</title>
    <style>
        body { max-width: 800px; margin: 20px auto; padding: 20px; }
        .container { display: flex; gap: 20px; }
        .input-section { flex: 1; }
        #response { 
            white-space: pre-wrap;
            border: 1px solid #ccc;
            padding: 10px;
            min-height: 200px;
        }
        #mapContainer {
            flex: 1;
            height: 400px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="input-section">
            <h2>æ—…æ¸¸é—®ç­”æµ‹è¯•</h2>
            <textarea id="question" rows="5" style="width: 100%" 
                placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šçƒŸå°æœ‰å“ªäº›é€‚åˆæƒ…ä¾£çš„æ™¯ç‚¹ï¼Ÿ"></textarea>
            <button onclick="submitQuestion()">æäº¤é—®é¢˜</button>
            <h3>å“åº”ç»“æœï¼š</h3>
            <div id="response"></div>
        </div>
        
        <div>
            <h3>åœ°å›¾å±•ç¤ºï¼š</h3>
            <div id="mapContainer"></div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–åœ°å›¾ï¼ˆéœ€è¦æ›¿æ¢ä¸ºæ‚¨çš„é«˜å¾·API keyï¼‰
        function initMap() {
            const map = new AMap.Map('mapContainer', {
                zoom: 12,
                center: [121.3914, 37.5393] // çƒŸå°ä¸­å¿ƒåæ ‡
            });
            window.map = map;
        }

        // æäº¤é—®é¢˜åˆ°åç«¯
        async function submitQuestion() {
            const question = document.getElementById('question').value;
            const responseDiv = document.getElementById('response');
            
            try {
                responseDiv.textContent = 'è¯·æ±‚ä¸­...';
                const response = await fetch('http://localhost:8000/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: question })
                });

                const data = await response.json();
                responseDiv.innerHTML = formatResponse(data.answer);
                updateMapMarkers(data.answer);
            } catch (error) {
                responseDiv.textContent = 'è¯·æ±‚å¤±è´¥: ' + error.message;
            }
        }

        // æ ¼å¼åŒ–å“åº”å†…å®¹
        function formatResponse(text) {
            return text.replace(/ğŸ” åœ°å›¾è·³è½¬ï¼š(.*?)( |$)/g, '<a href="$1" target="_blank">[æŸ¥çœ‹åœ°å›¾]</a> ');
        }

        // åˆå§‹åŒ–åŠ è½½åœ°å›¾
        window.onload = function() {
            // è¯·æ›¿æ¢ä¸ºæ‚¨çš„é«˜å¾·åœ°å›¾API Key
            const key = 'æ‚¨çš„é«˜å¾·API_KEY';
            const script = document.createElement('script');
            script.src = `https://webapi.amap.com/maps?v=2.0&key=${key}&callback=initMap`;
            document.head.appendChild(script);
        };
    </script>
</body>
</html>